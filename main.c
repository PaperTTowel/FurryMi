#include <stdio.h>
#include <stdlib.h> // system 명령어 사용시 필요 (안할경우 경고메시지 출력됨)
#include <windows.h>
#include <mmsystem.h> // 오디오 재생
#pragma comment(lib, "winmm.lib")
#include <digitalv.h> // 오디오 재생
#include <conio.h>
#include "code\prologue.c" // 프롤로그를 불러옴
#include "code\chapter1.c" // 제 1장을 불러옴

void color(int color){ // 콘솔 색
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), color);
}

void gotoxy(int x, int y){            // 텍스트 좌표
    COORD c; // 선언되어 있는 x,y 좌표 저장하는 놈
    c.X = x;
    c.Y = y;
    SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), c); // 콘솔의 핸들 값과 좌표값을 받아서, 해당 위치로 커서를 이동시키는 놈
}

int main(){
    /* vscode의 인코딩 방식을 ANSI 949 (EUC-KR)로 맞춰주십시오.
    Code Runner > Executor Map 에서 chcp 65001 && 부분을 지워주십시오.
    이 세팅은 윈도우10 CMD 환경에 적합한 인코딩 방식으로 제작됩니다. */
    system("MODE 98,30");
    printf("이 게임은 아직 중간저장을 지원하지 않습니다.\n");
    system("PAUSE");

    // 메인 화면 출력
    int menu;
    int Set[] = {7, 7, 7, 7}; // 기본 색상
    short counter = 2;
    char key;

    short windows = 0;

    mciSendString("open \".\\audio\\[BGM]木漏れ日の調べ.mp3\" type mpegvideo alias mp3", NULL, 0, NULL);
    mciSendString("play mp3 repeat", NULL, 0, NULL);

menu:
    system("cls");

    // 구 버전 CMD에 맞춘 타이틀
    printf("□■■■■□■□□□■□■■■□□■■■□□■□□□■□□□■■■■■□□■■■□□■□■□□□□\n");
    printf("□■□□□□■□□□■□■□□■□■□□■□■□□□■□□□□□■□□□■□□□■□■□■□□□□\n");
    printf("□■■■□□■□□□■□■■■□□■■■□□□■□■□□□□□□■□□□■■■■■□■□■□□□□\n");
    printf("□■□□□□■□□□■□■□□■□■□□■□□□■□□□□□□□■□□□■□□□■□■□■□□□□\n");
    printf("□■□□□□□■■■□□■□□■□■□□■□□□■□□□□□□□■□□□■□□□■□■□■■■■□\n");

    /* 레거시 CMD에서는 가독성 이슈가 발생함
    printf("■■■■■■■ ■■    ■■ ■■■■■■  ■■■■■■  ■■    ■■     ■■■■■■■■  ■■■■■  ■■ ■■      \n");
    printf("■■      ■■    ■■ ■■   ■■ ■■   ■■  ■■  ■■         ■■    ■■   ■■ ■■ ■■      \n");
    printf("■■■■■   ■■    ■■ ■■■■■■  ■■■■■■    ■■■■          ■■    ■■■■■■■ ■■ ■■      \n");
    printf("■■      ■■    ■■ ■■   ■■ ■■   ■■    ■■           ■■    ■■   ■■ ■■ ■■      \n");
    printf("■■       ■■■■■■  ■■   ■■ ■■   ■■    ■■           ■■    ■■   ■■ ■■ ■■■■■■■ \n");
    */
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 14);
    gotoxy(0, 5), printf("(c) 뒷돈받은 털묻은 스튜디오  |  겜창부 모둠원");
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), BACKGROUND_INTENSITY);
    gotoxy(0, 29), printf("| ↑: 위   ↓: 아래    ENTER: 확인   |   더 좋은 플레이 환경을 위해 콘솔에서 실행이 권장됩니다.   ");
    // system("color 07");
    for (short i = 0;;){
        gotoxy(10, 10);
        color(Set[0]);
        printf("1. 시작");

        gotoxy(10, 11);
        color(Set[1]);
        printf("2. 설정");

        gotoxy(10, 12);
        color(Set[2]);
        printf("3. 도움말");

        gotoxy(10, 13);
        color(Set[3]);
        printf("4. 종료");

        key = _getch();

        if (key == 72 && (counter >= 2 && counter <= 4)){ // 72 방향키 위키
            counter--;
            PlaySound(TEXT(".\\audio\\[SE]Cursor.wav"), 0, SND_ASYNC);
        }
        if (key == 80 && (counter >= 1 && counter <= 3)){ // 80 방향키 아래 키
            counter++;
            PlaySound(TEXT(".\\audio\\[SE]Cursor.wav"), 0, SND_ASYNC);
        }
        if (key == '\r'){ // 객체 반환 = 엔터 키
            if (counter == 1){
                mciSendString("stop mp3", NULL, 0, NULL);
                PlaySound(TEXT(".\\audio\\[SE]Interaction"), 0, SND_ASYNC);
                system("cls");
                if(windows == 0) system("MODE 120,10");
                gotoxy(45, 2);
                printf("스크립트를 불러오고 있습니다.");
                Sleep(3000); // 지연
                system("cls");
                if(windows == 0) system("MODE 83,20");
                system("color 87");
                PlaySound(TEXT(".\\audio\\[SE]Chime.wav"), 0, SND_ASYNC);
                printf("┌────────────────────────────────────────────────────────────────────────────────┐\n"), Sleep(20);
                printf("│"), gotoxy(36, 1), printf("DISCLAIMER!"), gotoxy(81, 1), printf("│\n");
                printf("├"), printf("────────────────────────────────────────────────────────────────────────────────"), gotoxy(81, 2), printf("┤\n"), Sleep(20);
                printf("│"), gotoxy(81, 3), printf("│\n"), Sleep(20);
                printf("│"), gotoxy(81, 4), printf("│\n"), Sleep(20);
                printf("│"), gotoxy(81, 5), printf("│\n"), Sleep(20);
                printf("│"), gotoxy(81, 6), printf("│\n"), Sleep(20);
                printf("│"), gotoxy(81, 7), printf("│\n"), Sleep(20);
                printf("│"), gotoxy(81, 8), printf("│\n"), Sleep(20);
                printf("└────────────────────────────────────────────────────────────────────────────────┘\n"), Sleep(20);
                gotoxy(2, 4), printf("게임 및 게임 홍보물에 언급되거나 묘사된");
                gotoxy(2, 5), printf("인명, 인물, 스크립트, 음성, 회사, 단체, 지명, 국명, 사건, 제품,");
                gotoxy(2, 6), printf("그리고 모든 고유명사는 전부 실제와는 일절 관계가 없이 허구적으로 창작된 것이며");
                gotoxy(2, 7), printf("만일 실제와 같은 경우가 있더라도 이는 우연에 의한 것임을 밝힙니다.");
                gotoxy(1, 19), system("PAUSE");
                system("color 07");
                system("cls");
                system("MODE 98,30");
                Sleep(1500);
                prologue();
                break;
            }

            if (counter == 2){
                Set[1] = 7;
                PlaySound(TEXT(".\\audio\\[SE]Action"), 0, SND_ASYNC);
                // SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 55);
                gotoxy(40, 8), printf("┌───────────────────────────────────────────────────────┐\n"), Sleep(10);
                gotoxy(40, 9), printf("│"), gotoxy(96, 9), printf("│\n"), gotoxy(44, 8), printf(" 설정 "), Sleep(10);
                gotoxy(40, 10), printf("│"), gotoxy(96, 10), printf("│\n"), Sleep(10);
                gotoxy(40, 11), printf("│"), gotoxy(96, 11), printf("│\n"), Sleep(10);
                gotoxy(40, 12), printf("│"), gotoxy(96, 12), printf("│\n"), Sleep(10);
                gotoxy(40, 13), printf("│"), gotoxy(96, 13), printf("│\n"), Sleep(10);
                gotoxy(40, 14), printf("│"), gotoxy(96, 14), printf("│\n"), Sleep(10);
                gotoxy(40, 15), printf("│"), gotoxy(96, 15), printf("│\n"), Sleep(10);
                gotoxy(40, 16), printf("│"), gotoxy(96, 16), printf("│\n"), Sleep(10);
                gotoxy(40, 17), printf("│"), gotoxy(96, 17), printf("│\n"), Sleep(10);
                gotoxy(40, 18), printf("│"), gotoxy(96, 18), printf("│\n"), Sleep(10);
                gotoxy(40, 19), printf("│"), gotoxy(96, 19), printf("│\n"), Sleep(10);
                gotoxy(40, 20), printf("│"), gotoxy(96, 20), printf("│\n"), Sleep(10);
                gotoxy(40, 21), printf("└───────────────────────────────────────────────────────┘\n"), Sleep(10);
                for (short i = 0;;){
                    if(windows == 0){
                        gotoxy(43, 10);
                        color(Set[0]);
                        printf("수동형 해상도로 변경             ");
                    }
                    else{
                        gotoxy(43, 10);
                        color(Set[0]);
                        printf("자동형 해상도로 변경");
                    }

                    gotoxy(43, 11);
                    color(Set[1]);
                    printf("음량");

                    gotoxy(43, 12);
                    color(Set[2]);
                    printf("언어");

                    gotoxy(42, 19);
                    color(Set[3]);
                    printf("← 뒤로가기");

                    key = _getch();

                    if (key == 72 && (counter >= 2 && counter <= 4)){ // 72 방향키 위키
                        counter--;
                        PlaySound(TEXT(".\\audio\\[SE]Cursor.wav"), 0, SND_ASYNC);
                    }
                    if (key == 80 && (counter >= 1 && counter <= 3)){ // 80 방향키 아래 키
                        counter++;
                        PlaySound(TEXT(".\\audio\\[SE]Cursor.wav"), 0, SND_ASYNC);
                    }
                    if (key == '\r'){
                        if (counter == 1){
                            if(windows == 0) PlaySound(TEXT(".\\audio\\[SE]Flash.wav"), 0, SND_ASYNC);
                            if(windows == 1) PlaySound(TEXT(".\\audio\\[SE]Saint.wav"), 0, SND_ASYNC);
                            if(windows == 0){
                                gotoxy(41, 9), printf("┌─────────────────────────────────────────────────────┐\n"), Sleep(10);
                                gotoxy(41, 10), printf("│"), gotoxy(95, 10), printf("│\n"), gotoxy(60, 9), printf(" 안내 "), Sleep(10);
                                gotoxy(41, 11), printf("│"), gotoxy(95, 11), printf("│\n"), Sleep(10);
                                gotoxy(41, 12), printf("│"), gotoxy(95, 12), printf("│\n"), Sleep(10);
                                gotoxy(41, 13), printf("│"), gotoxy(95, 13), printf("│\n"), Sleep(10);
                                gotoxy(41, 14), printf("│"), gotoxy(95, 14), printf("│\n"), Sleep(10);
                                gotoxy(41, 15), printf("│"), gotoxy(95, 15), printf("│\n"), Sleep(10);
                                gotoxy(41, 16), printf("│"), gotoxy(95, 16), printf("│\n"), Sleep(10);
                                gotoxy(41, 17), printf("│"), gotoxy(95, 17), printf("│\n"), Sleep(10);
                                gotoxy(41, 18), printf("└─────────────────────────────────────────────────────┘\n"), Sleep(10);
                                gotoxy(43, 10), printf("기존 해상도로 변경하시겠습니까?");
                                SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 14);
                                gotoxy(43, 11), printf("                  ");
                                gotoxy(43, 12), printf("이 설정은 콘솔 모드에서만 적용됩니다.");
                                gotoxy(43, 13), printf("Windows 터미널에서는 영향을 받지 않습니다.");
                                for(short i = 0;;){
                                    gotoxy(43, 15), color(Set[0]) ,printf("예");
                                    gotoxy(43, 16), color(Set[1]), printf("아니오");
                                    key = _getch();
                                    if (key == 72 && (counter >= 2 && counter <= 2)){ // 72 방향키 위키
                                        counter--;
                                        PlaySound(TEXT(".\\audio\\[SE]Cursor.wav"), 0, SND_ASYNC);
                                        }
                                    if (key == 80 && (counter >= 1 && counter <= 1)){ // 80 방향키 아래 키
                                        counter++;
                                        PlaySound(TEXT(".\\audio\\[SE]Cursor.wav"), 0, SND_ASYNC);
                                    }
                                    if (key == '\r'){
                                        if(counter == 1){
                                            windows = 1;
                                            PlaySound(TEXT(".\\audio\\[SE]Saint.wav"), 0, SND_ASYNC);
                                            system("MODE 120,30");
                                            system("color 07");
                                            goto menu;
                                        }
                                        if(counter == 2){
                                            windows = 1;
                                            PlaySound(TEXT(".\\audio\\[SE]Cancel.wav"), 0, SND_ASYNC);
                                            system("color 07");
                                            goto menu;
                                        }
                                    }
                                    Set[0] = 7;
                                    Set[1] = 7;
                                    Set[2] = 7;
                                    Set[3] = 7;
                                    if (counter == 1)
                                        Set[0] = 12;
                                    if (counter == 2)
                                        Set[1] = 12;
                                    if (counter == 3)
                                        Set[2] = 12;
                                    if (counter == 4)
                                        Set[2] = 12;
                                }
                            }
                            else{
                                windows = 0;
                                system("MODE 98,30");
                                goto menu;
                            }
                        }
                        if (counter == 2){
                            PlaySound(TEXT(".\\audio\\[SE]Failure.wav"), 0, SND_ASYNC);
                            gotoxy(57, 19), printf("설정 불가능!");
                        }
                        if (counter == 3){
                            PlaySound(TEXT(".\\audio\\[SE]Failure.wav"), 0, SND_ASYNC);
                            gotoxy(57, 19), printf("설정 불가능!");
                        }
                        if (counter == 4){
                            PlaySound(TEXT(".\\audio\\[SE]Cancel.wav"), 0, SND_ASYNC);
                            counter = 2;
                            Set[3] = 7;
                            system("color 07");
                            goto menu;
                        }
                    }
                    Set[0] = 7;
                    Set[1] = 7;
                    Set[2] = 7;
                    Set[3] = 7;
                    if (counter == 1)
                        Set[0] = 12;
                    if (counter == 2)
                        Set[1] = 12;
                    if (counter == 3)
                        Set[2] = 12;
                    if (counter == 4)
                        Set[3] = 12;
                }
                gotoxy(1, 29), system("PAUSE");
                system("color 07");
                goto menu;
            }

            if (counter == 3){
                PlaySound(TEXT(".\\audio\\[SE]Action"), 0, SND_ASYNC);
                system("cls");
                system("color 17");
                printf("┌─────────────────────────────────┰─────────────────────────────────────────────────────────────┐\n");
                printf("│"), gotoxy(4, 0), printf(" 도움말 "), gotoxy(1, 1), printf("  이동: 방향키   상호작용: 엔터  ┃  더 좋은 플레이 환경을 위해 콘솔에서 실행이 권장됩니다."), gotoxy(96, 1), printf("│\n");
                printf("├"), printf("─────────────────────────────────┸─────────────────────────────────────────────────────────────"),
                gotoxy(96, 2), printf("┤\n");
                printf("│"), gotoxy(96, 3), printf("│\n");
                printf("│"), gotoxy(96, 4), printf("│\n");
                printf("│"), gotoxy(96, 5), printf("│\n");
                printf("│"), gotoxy(96, 6), printf("│\n");
                printf("│"), gotoxy(96, 7), printf("│\n");
                printf("│"), gotoxy(96, 8), printf("│\n");
                printf("│"), gotoxy(96, 9), printf("│\n");
                printf("│"), gotoxy(96, 10), printf("│\n");
                printf("│"), gotoxy(96, 11), printf("│\n");
                printf("│"), gotoxy(96, 12), printf("│\n");
                printf("└───────────────────────────────────────────────────────────────────────────────────────────────┘\n");
                gotoxy(25, 3), printf("이 게임은 콘솔을 기반으로 제작된 미연시입니다.\n");
                gotoxy(25, 4), printf("프로그래밍 수행평가에 의해 제작되었습니다.");
                gotoxy(2, 6), printf("스토리 및 세계관 기획: 30508 김윤기");
                gotoxy(2, 7), printf("메인화면 프로그래밍: 30507 김원혁");
                gotoxy(2, 8), printf("프롤로그 프로그래밍: ");
                gotoxy(2, 9), printf("챕터1 프로그래밍: ");
                gotoxy(2, 10), printf("챕터2 프로그래밍: ");
                gotoxy(2, 11), printf("챕터3 프로그래밍: ");
                gotoxy(1, 29), system("PAUSE");
                system("color 07");
                goto menu;
            }

            if (counter == 4){
                counter = 2;
                PlaySound(TEXT(".\\audio\\[SE]Flash.wav"), 0, SND_ASYNC);
                SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 7);
                gotoxy(41, 9), printf("┌─────────────────────────────────────────────────────┐\n"), Sleep(10);
                gotoxy(41, 10), printf("│"), gotoxy(95, 10), printf("│\n"), gotoxy(60, 9), printf(" 안내 "), Sleep(10);
                gotoxy(41, 11), printf("│"), gotoxy(95, 11), printf("│\n"), Sleep(10);
                gotoxy(41, 12), printf("│"), gotoxy(95, 12), printf("│\n"), Sleep(10);
                gotoxy(41, 13), printf("│"), gotoxy(95, 13), printf("│\n"), Sleep(10);
                gotoxy(41, 14), printf("│"), gotoxy(95, 14), printf("│\n"), Sleep(10);
                gotoxy(41, 15), printf("│"), gotoxy(95, 15), printf("│\n"), Sleep(10);
                gotoxy(41, 16), printf("│"), gotoxy(95, 16), printf("│\n"), Sleep(10);
                gotoxy(41, 17), printf("│"), gotoxy(95, 17), printf("│\n"), Sleep(10);
                gotoxy(41, 18), printf("└─────────────────────────────────────────────────────┘\n"), Sleep(10);
                gotoxy(43, 10), printf("가끔 현실을 사는것도 좋습니다.");
                SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 14);
                gotoxy(43, 12), printf("게임을 종료하시겠습니까?");
                for(short i = 0;;){
                    gotoxy(43, 15), color(Set[0]) ,printf("예");
                    gotoxy(43, 16), color(Set[1]), printf("아니오");
                    key = _getch();
                    if (key == 72 && (counter >= 2 && counter <= 2)){ // 72 방향키 위키
                        counter--;
                        PlaySound(TEXT(".\\audio\\[SE]Cursor.wav"), 0, SND_ASYNC);
                    }
                    if (key == 80 && (counter >= 1 && counter <= 1)){ // 80 방향키 아래 키
                        counter++;
                        PlaySound(TEXT(".\\audio\\[SE]Cursor.wav"), 0, SND_ASYNC);
                    }
                    if (key == '\r'){
                        if(counter == 1){
                            exit(EXIT_SUCCESS);
                        }
                        if(counter == 2){
                            PlaySound(TEXT(".\\audio\\[SE]Cancel.wav"), 0, SND_ASYNC);
                            system("color 07");
                            Set[1] = 7;
                            goto menu;
                        }
                    }
                    Set[0] = 7;
                    Set[1] = 7;
                    Set[2] = 7;
                    Set[3] = 7;
                    if (counter == 1)
                        Set[0] = 12;
                    if (counter == 2)
                        Set[1] = 12;
                    if (counter == 3)
                        Set[2] = 12;
                    if (counter == 4)
                        Set[2] = 12;
                }
            }
                
        }
        Set[0] = 7;
        Set[1] = 7;
        Set[2] = 7;
        Set[3] = 7;
        if (counter == 1)
            Set[0] = 12;
        if (counter == 2)
            Set[1] = 12;
        if (counter == 3)
            Set[2] = 12;
        if (counter == 4)
            Set[3] = 12;
    }

    /* 매우 간단한 a,b,c 선택지
    printf("옵션을 선택하십시오: "), scanf("%c", &menu);

    switch (menu){
    case 'a': // 시작
        printf("\n스크립트를 불러오고 있습니다.");
        Sleep(2000); // 지연
        system("cls");
        break;
    case 'b': // 옵션
        break;
    case 'c': // 종료
        exit(EXIT_SUCCESS);
        break;
    default:
        printf("\n없는 옵션 입니다.\n");
        system("PAUSE");
        goto menu;
    }
    */
    return 0;
}